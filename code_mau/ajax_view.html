def ajax_page_create(request):
  if request.method == 'POST':
      if request.is_ajax():
          result = AjaxResponseResult.success.value
          try:
              # 1) Lấy các giá trị từ request
              param_title = request.POST['title']
              param_meta_description = request.POST['meta_description']
              param_sub_title = request.POST['sub_title']
              param_content_title = request.POST['content_title']
              param_content = request.POST['content']
              param_campaign_name = request.POST['campaign_name']
              param_uri = request.POST['uri']
              param_form_id = request.POST['form_id']
              param_email_id = request.POST['email_id']
              param_site_id = request.POST['site_id']
              param_input_file = request.POST['input_file']

              print(param_input_file)

              return HttpResponse(result)
          except Exception as inst:
              #1. Trường hợp là hàm Ajax thì trả về giá trị AjaxResponseResult = -1
              result = AjaxResponseResult.error.value

              #2. Lấy thông tin chi tiết lỗi (Msg, File name, Line number)
              exc_type, ms_tb, exc_tb = sys.exc_info()
              fname = os.path.split(exc_tb.tb_frame.f_code.co_filename)[1]
              exc_msg = 'File : {0} | Line : {1} | Type : {2}\nError: {3}'.format(fname, exc_tb.tb_lineno,exc_type,ms_tb)

              #4. In ra màn hình console
              print(exc_msg)

          return HttpResponse(result)
      return HttpResponse('')
============================================================================================================
def ajax_blog_delete(request):
    if request.method == 'POST':
        if request.is_ajax():
            result = AjaxResponseResult.success.value
            try:
                # 1) Lấy các giá trị từ request
                param_list_site_id = request.POST['list_site_id']
                param_list_blog_id = request.POST['list_blog_id']
                print(param_list_site_id)
                print(param_list_blog_id)
                # 2) Thực hiện câu lệnh query

                # 3) Lấy tổng số bản ghi để phân trang
                return HttpResponse(result)
            except Exception as inst:
                #1. Trường hợp là hàm Ajax thì trả về giá trị AjaxResponseResult = -1
                result = AjaxResponseResult.error.value

                #2. Lấy thông tin chi tiết lỗi (Msg, File name, Line number)
                exc_type, ms_tb, exc_tb = sys.exc_info()
                fname = os.path.split(exc_tb.tb_frame.f_code.co_filename)[1]
                exc_msg = 'File : {0} | Line : {1} | Type : {2}\nError: {3}'.format(fname, exc_tb.tb_lineno,exc_type,ms_tb)
                
                #3. Lưu vào file erro.log
                logger.error('Exception : ' + str(type(inst)))
                logger.error(exc_msg)

                #4. In ra màn hình console
                print(exc_msg)

            return HttpResponse(result)
        return HttpResponse('')


========================================== View download ==================================================
def partner_download_report(request):
  if request.method == 'GET':
    result = AjaxResponseResult.success.value
    try:
      
      # 1) Lấy các giá trị từ request
      param_site_id  = int(request.GET['site_id'])
      param_date = request.GET['date']
      #2 Check security
      #2.1 kiểm tra có phải user đã login:
      if request.user.is_authenticated:
        #2.2 kiểm tra user đã auth chưa
        hub_auth_client = HubAuth()
        authenticat_state = hub_auth_client.get_authenticate_state(request,param_site_id)

        if authenticat_state == '1':
          hub_auth_client = HubAuth()
          access_token = hub_auth_client.get_last_access_token(request, param_site_id)

          # 3) Lấy tên domain từ DB
          query_site_info = '''SELECT *
                                FROM management_site a 
                                WHERE a.id = {0}'''.format(param_site_id)
          object_site_info = db_controller.query(query_site_info)
          file_name = object_site_info[0].get('name') + "-Channel Partner" + "_" + param_date + ".xlsx"
          response = get_data_partner.partner_month_report(file_name,param_site_id)
          #file_name = object_site_info[0].get('name') + "-All Partner" + "_" + param_date + ".xlsx"
          #response = get_data_partner.download_partner_month_report(file_name,param_site_id,access_token)
          print("Complete create report")

      return response
    except Exception as inst:
      #1. Trường hợp là hàm Ajax thì trả về giá trị AjaxResponseResult = -1
      result = AjaxResponseResult.error.value

      #2. Lấy thông tin chi tiết lỗi (Msg, File name, Line number)
      exc_type, ms_tb, exc_tb = sys.exc_info()
      fname = os.path.split(exc_tb.tb_frame.f_code.co_filename)[1]
      exc_msg = 'File : {0} | Line : {1} | Type : {2}\nError: {3}'.format(fname, exc_tb.tb_lineno,exc_type,ms_tb)
        
      #3. Lưu vào file erro.log
      logger.error('Exception : ' + str(type(inst)))
      logger.error(exc_msg)

      #4. In ra màn hình console
      print(exc_msg)
    return HttpResponse(result)
  return HttpResponse('')

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////// Download //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    url(r'^customer/download/(?P<site_id>\d+)/(?P<start_day>\d+)/(?P<end_day>\d+)$', views.ajax_customer_download, name='ajax_customer_download'),
    $("a#download").attr('href','/report/customer/download/'+site_id+'/'+start_day+'/'+end_day);

def download_month_report(request):
  if request.method == 'GET':
      try:
          #1 Lấy các giá trị từ request
          param_date = request.GET['date']
          param_site_id = int(request.GET['site_id'])

          #2 Check security
          #2.1 Kiểm tra có phải user đã login
          if request.user.is_authenticated :
            #2.2 Kiểm tra user đã auth chưa
            hub_auth_client = HubAuth()
            authenticat_state = hub_auth_client.get_authenticate_state(request, param_site_id)
            
            if authenticat_state == '1':
              #3 Lấy tên domain từ DB
              query_site_info = '''SELECT *
                                  FROM management_site a 
                                  WHERE a.id = {0}'''.format(param_site_id)
              object_site_info = db_controller.query(query_site_info)

              #4 Thực hiện tạo file excel
              year = param_date[0:4]
              month = param_date[5:]
              print("Year take report : %10s" %(year) )
              file_name = object_site_info[0]['name'] + "_" + param_date + ".xlsx"
              response = export_report.month_report(file_name,int(year),int(month),param_site_id)  
              print("Complete create report")
              return response
            else :
              return HttpResponse('Please authentication to download')
          else :
            return HttpResponse('Please login to download')
      except Exception as inst:
        #1. Trường hợp là hàm Ajax thì trả về giá trị AjaxResponseResult = -1
        result = AjaxResponseResult.error.value

        #2. Lấy thông tin chi tiết lỗi (Msg, File name, Line number)
        exc_type, ms_tb, exc_tb = sys.exc_info()
        fname = os.path.split(exc_tb.tb_frame.f_code.co_filename)[1]
        exc_msg = 'File : {0} | Line : {1} | Type : {2}\nError: {3}'.format(fname, exc_tb.tb_lineno,exc_type,ms_tb)
        
        #3. Lưu vào file erro.log
        logger.error('Exception : ' + str(type(inst)))
        logger.error(exc_msg)

        #4. In ra màn hình console
        print(exc_msg)

      return HttpResponse(result)
  return HttpResponse('')
